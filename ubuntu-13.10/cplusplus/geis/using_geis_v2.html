<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>GEIS: Using The Advanced Interface</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="https://developer.ubuntu.com/api/devel/ubuntu-13.10/cplusplus/geis/jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo_x64.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">GEIS
   &#160;<span id="projectnumber">2.0</span>
   </div>
   <div id="projectbrief">Gesture Engine Interface Support</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('using_geis_v2.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Using The Advanced Interface </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="using_geis_v2_intro"></a>
Introduction to the Advanced GEIS Interface</h1>
<p>The advanced GEIS interface is designed around the idea that you can create <em>filters</em> to limit the kinds of gestures received and combine those filters into <em>subscriptions</em> that interact with the gesture recognizer to deliver <em>gesture events</em>.</p>
<p>The normal flow for using the advanced interface is as follows.</p>
<ol type="1">
<li>create a <a class="el" href="class_geis.html" title="Represents an instance of the gesture recognition engine. ">Geis</a> object</li>
<li>create a <a class="el" href="class_geis_subscription.html" title="A gesture recognition subscription. ">GeisSubscription</a> object on the <a class="el" href="class_geis.html" title="Represents an instance of the gesture recognition engine. ">Geis</a> object</li>
<li>create and add one or more <a class="el" href="class_geis_filter.html" title="Selects a subset of possible gestures in a subscription. ">GeisFilter</a> to the <a class="el" href="class_geis_subscription.html" title="A gesture recognition subscription. ">GeisSubscription</a></li>
<li>activate the <a class="el" href="class_geis_subscription.html" title="A gesture recognition subscription. ">GeisSubscription</a></li>
<li>wait for and process a series of <a class="el" href="class_geis_event.html" title="A generic GEIS event. ">GeisEvent</a></li>
</ol>
<h2><a class="anchor" id="using_geis_v2_example"></a>
An example of advanced API usage</h2>
<p>This is an example of using the advanced (GEIS v2) API. The full source code for this example (including details missing here) is included in the source distribution of geis.</p>
<p>Please note that these examples omit all of the error checking for expository purposes only.</p>
<p>First, a function to create the filters for a subscription. the filters can not be created until the gesture recognition engine initialization is complete, since otherwise the expected types of the gesture attributes on which to filter are not known by the interface.</p>
<p>An empty filter is created. An empty filter means <em>all</em> input devices, <em>all</em> gestures, <em>all</em> regions. For the purpose of this example, we want just 2-touch gestures, so we need to add a term to the filter specifying only those gestures with two touches. <div class="fragment"><div class="line">target_subscription(<a class="code" href="class_geis.html" title="Represents an instance of the gesture recognition engine. ">Geis</a> geis, <a class="code" href="class_geis_subscription.html" title="A gesture recognition subscription. ">GeisSubscription</a> subscription)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="group__geis__common.html#ga7fe40cb68bb7a98f5429284514872790" title="Errors returned from calls. ">GeisStatus</a> status;</div>
<div class="line">  <a class="code" href="class_geis_filter.html" title="Selects a subset of possible gestures in a subscription. ">GeisFilter</a> filter = <a class="code" href="group__geis__v2__filter.html#ga52d7bfa7915e2cedd4076a30daad6071" title="Creates a new, empty filter. ">geis_filter_new</a>(geis, <span class="stringliteral">&quot;filter&quot;</span>);</div>
<div class="line">  <a class="code" href="group__geis__v2__filter.html#gae3d533aca3aed29df70116a90300373e" title="Adds a term to a filter. ">geis_filter_add_term</a>(filter,</div>
<div class="line">                       <a class="code" href="group__geis__v2__filter.html#gga34f77c178889dfb4c0e0a67bab448a88a3092a0e76147413bc884853485f421bf" title="Filters on gesture class and gesture attributes. ">GEIS_FILTER_CLASS</a>,</div>
<div class="line">                       GEIS_GESTURE_ATTRIBUTE_TOUCHES, <a class="code" href="group__geis__v2__filter.html#gga7f26674f8204c7f92e76a4b56cbf5819aa014b8c6c240fe69d981186af44ac92a" title="Compares for equality. ">GEIS_FILTER_OP_EQ</a>, 2,</div>
<div class="line">                       NULL);</div>
<div class="line"></div>
<div class="line">  status = <a class="code" href="group__geis__v2__subscription.html#ga2dbffb51db39ea96ae4b789920dd5a4c" title="Adds a filter to a subscription. ">geis_subscription_add_filter</a>(subscription, filter);</div>
<div class="line">  <span class="keywordflow">if</span> (status != <a class="code" href="group__geis__common.html#gga7fe40cb68bb7a98f5429284514872790a4b15ef395a0628e8c820e286e7956081" title="normal successful completion ">GEIS_STATUS_SUCCESS</a>)</div>
<div class="line">  {</div>
<div class="line">    fprintf(stderr, <span class="stringliteral">&quot;error adding filter\n&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --></p>
<p>In the main fucntion, the API instance is created. We tell it to report input devices and gesture classes. <div class="fragment"><div class="line">  geis = <a class="code" href="group__geis__v2__geis.html#gafa6d38f736262c4c39a0265a660ae174" title="Initializes an instance of the GEIS v2.0 API. ">geis_new</a>(<a class="code" href="group__geis__v2__geis.html#ga219d08ef09bb7bd978c4c7861df55d47" title="Tells GEIS to send input device events. ">GEIS_INIT_TRACK_DEVICES</a>,</div>
<div class="line">                  <a class="code" href="group__geis__v2__geis.html#ga2374f19838707466bcfd4461c7e56e76" title="Tells GEIS to send gesture class events. ">GEIS_INIT_TRACK_GESTURE_CLASSES</a>,</div>
<div class="line">                  NULL);</div>
</div><!-- fragment --></p>
<p>For the event loop processing, we're going to need the event fd (this is assuming a Unix implementation of GEIS, other platforms may have a different event indicator). <div class="fragment"><div class="line">  <a class="code" href="group__geis__v2__config.html#ga68954ae949e85ebc2c496ff7509f88f8" title="Gets a feature configuration value. ">geis_get_configuration</a>(geis, <a class="code" href="group__geis__v2__config.html#ga73b1bfd0e2f3885f21dfad2567736f28" title="Gets a Unix file descriptor that will signal the availablility of GEIS events for processing...">GEIS_CONFIGURATION_FD</a>, &amp;fd);</div>
</div><!-- fragment --></p>
<p>A subscription object is created. We want gesture continuations. <div class="fragment"><div class="line">  subscription = <a class="code" href="group__geis__v2__subscription.html#ga35a50b739ff2807107dc8a43296ca020" title="Creates a new subscription. ">geis_subscription_new</a>(geis, <span class="stringliteral">&quot;example&quot;</span>, <a class="code" href="group__geis__v2__subscription.html#gga06fc87d81c62e9abb8790b6e5713c55ba4c153fec6eee04183371ac4022dab5dd" title="The gesture engine will return gesture continuations, in which the class of a recognized gestire may ...">GEIS_SUBSCRIPTION_CONT</a>);</div>
</div><!-- fragment --></p>
<p>The application's main event loop is run until a read is indicated as available on the event fd, at which point the GEIS event loop is pumped. <div class="fragment"><div class="line">      status = <a class="code" href="group__geis__v2__event__control.html#ga599f3dbfbb9276ee05e199c7828791d9" title="Pumps the GEIS event loop. ">geis_dispatch_events</a>(geis);</div>
<div class="line">      status = <a class="code" href="group__geis__v2__event__control.html#ga608d4dec827545b6dc38a18a2c33b338" title="Retrieves the next queued GEIS event. ">geis_next_event</a>(geis, &amp;event);</div>
</div><!-- fragment --> The events are handled and the event loop pumped until it's empty. <div class="fragment"><div class="line">      <span class="keywordflow">while</span> (status == <a class="code" href="group__geis__common.html#gga7fe40cb68bb7a98f5429284514872790a773eaea5f9943ee52f30f0133bdc09ca" title="normal successful completion with data still remaining ">GEIS_STATUS_CONTINUE</a> || status == <a class="code" href="group__geis__common.html#gga7fe40cb68bb7a98f5429284514872790a4b15ef395a0628e8c820e286e7956081" title="normal successful completion ">GEIS_STATUS_SUCCESS</a>)</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">switch</span> (<a class="code" href="group__geis__v2__event__control.html#gae54883e4bfedc254cd02ea2c7efaf21d" title="Gets the type of the event. ">geis_event_type</a>(event))</div>
<div class="line">        {</div>
<div class="line">          <span class="keywordflow">case</span> GEIS_EVENT_INIT_COMPLETE:</div>
<div class="line">            target_subscription(geis, subscription);</div>
<div class="line">            status = <a class="code" href="group__geis__v2__subscription.html#gaf9ab0c59c1848d502fa0041cbe90d8b3" title="Activates a subscription. ">geis_subscription_activate</a>(subscription);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">          <span class="keywordflow">case</span> GEIS_EVENT_DEVICE_AVAILABLE:</div>
<div class="line">          <span class="keywordflow">case</span> GEIS_EVENT_DEVICE_UNAVAILABLE:</div>
<div class="line">            dump_device_event(event);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">          <span class="keywordflow">case</span> GEIS_EVENT_GESTURE_BEGIN:</div>
<div class="line">          <span class="keywordflow">case</span> GEIS_EVENT_GESTURE_UPDATE:</div>
<div class="line">          <span class="keywordflow">case</span> GEIS_EVENT_GESTURE_END:</div>
<div class="line">            dump_gesture_event(event);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line"></div>
<div class="line">          <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <a class="code" href="group__geis__v2__event__control.html#ga6a145ff415ea4ab94636286fffd36398" title="Destroys a GeisEvent. ">geis_event_delete</a>(event);</div>
<div class="line">        status = <a class="code" href="group__geis__v2__event__control.html#ga608d4dec827545b6dc38a18a2c33b338" title="Retrieves the next queued GEIS event. ">geis_next_event</a>(geis, &amp;event);</div>
</div><!-- fragment --></p>
<p>Finally, the API objects are cleaned up. <div class="fragment"><div class="line">  <a class="code" href="group__geis__v2__subscription.html#ga4ceccde5ea4fd59171bd0d33b7d50d53" title="Destroys a GEIS v2.0 subscription object. ">geis_subscription_delete</a>(subscription);</div>
<div class="line">  <a class="code" href="group__geis__v2__geis.html#gac8d351201dd533e41d235d5921971a9f" title="Cleans up an instance of the GEIS v2.0 API. ">geis_delete</a>(geis);</div>
</div><!-- fragment --></p>
<h2><a class="anchor" id="using_geis_v2_examining_devices"></a>
Examining Devices</h2>
<p><div class="fragment"><div class="line">dump_device_event(<a class="code" href="class_geis_event.html" title="A generic GEIS event. ">GeisEvent</a> event)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="class_geis_device.html" title="A gesture-capable input device. ">GeisDevice</a> device;</div>
<div class="line">  GeisAttr attr;</div>
<div class="line">  GeisSize i;</div>
<div class="line"></div>
<div class="line">  attr = <a class="code" href="group__geis__v2__event__control.html#gabb751273c7c3297c692196bdd1b6fb45" title="Gets a named attribute from the event. ">geis_event_attr_by_name</a>(event, <a class="code" href="group__geis__v2__device.html#ga15db5a218633ecbe74cbf8c529b4ee6f" title="The event attribute containing a pointer to a GeisDevice. ">GEIS_EVENT_ATTRIBUTE_DEVICE</a>);</div>
<div class="line">  device = <a class="code" href="group__geis__v2__attrs.html#gac023776d0497ca3fe7ce1b42d6f663ac" title="Gets the value of an attribute as a GeisPointer. ">geis_attr_value_to_pointer</a>(attr);</div>
<div class="line">  printf(<span class="stringliteral">&quot;device %02d \&quot;%s\&quot;\n&quot;</span>,</div>
<div class="line">         <a class="code" href="group__geis__v2__device.html#ga50dc0197231d68f2b8933c6b25ccde17" title="Gets the system identifier of the iput device. ">geis_device_id</a>(device), <a class="code" href="group__geis__v2__device.html#gaf8af5a75015b66cce547d0b39dec94c7" title="Gets the name of the input device. ">geis_device_name</a>(device));</div>
<div class="line">  <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="group__geis__v2__device.html#ga5aa6e28512e5bfaf977cb9e49b33c336" title="Gets the number of attributes of the device. ">geis_device_attr_count</a>(device); ++i)</div>
<div class="line">  {</div>
<div class="line">    print_attr(<a class="code" href="group__geis__v2__device.html#ga09aff11d9194ca467d7c84487288f975" title="Gets the indicated attribute of the device. ">geis_device_attr</a>(device, i));</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --> </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Sep 19 2013 22:21:50 for GEIS by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
